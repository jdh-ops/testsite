<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê³ ê¸‰ ë°ì´í„° í•„í„° ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 100%; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* í•„í„° ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .filter-section { background: #f1f3f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .filter-group { margin-bottom: 15px; }
        .filter-title { font-weight: bold; margin-bottom: 8px; display: block; color: #495057; }
        
        /* 1. ê·¸ë£¹ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .preset-buttons { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn-preset { padding: 6px 12px; background: #5c6bc0; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; }
        .btn-preset:hover { background: #3f51b5; }

        /* 2. ë‹¤ì¤‘ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checkbox-group { display: flex; gap: 15px; flex-wrap: wrap; padding: 10px; background: white; border-radius: 5px; border: 1px solid #dee2e6; }
        .checkbox-item { display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 14px; }

        /* í…Œì´ë¸” ê´€ë ¨ */
        .table-wrapper { overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid #dee2e6; padding: 12px; text-align: left; position: relative; }
        th { background: #e9ecef; }
        .resizer { position: absolute; right: 0; top: 0; width: 5px; height: 100%; cursor: col-resize; }
        .url-cell { word-break: break-all; font-size: 13px; }
        tr:hover { background-color: #f1f3f9; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“Š ë°ì´í„° ë©€í‹° í•„í„° ëŒ€ì‹œë³´ë“œ</h2>

    <div class="filter-section">
        <div class="filter-group">
            <span class="filter-title">ğŸ“Œ ë¹ ë¥¸ ê·¸ë£¹ ì„ íƒ</span>
            <div class="preset-buttons">
                <button class="btn-preset" onclick="selectPreset(['ebay', 'naver'])">í¬í„¸ ì‚¬ì´íŠ¸</button>
                <button class="btn-preset" onclick="resetCheckboxes()">ì „ì²´ í•´ì œ</button>
            </div>
        </div>

        <div class="filter-group">
            <span class="filter-title">ğŸ” í”Œë«í¼ ë‹¤ì¤‘ ì„ íƒ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</span>
            <div id="platformCheckboxes" class="checkbox-group">
                </div>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ í†µí•© ê²€ìƒ‰..." style="padding:10px; width:300px; border-radius:5px; border:1px solid #ddd;">
            <div id="status" style="font-weight:bold; color:#5c6bc0;">ë¡œë“œ ì¤‘...</div>
        </div>
    </div>

    <div class="table-wrapper">
        <table id="mainTable">
            <thead>
                <tr>
                    <th style="width:140px;">ì „ë‹¬ë‚ ì§œ <span onclick="toggleSort()" style="cursor:pointer; color:#5c6bc0;">â†•</span><div class="resizer"></div></th>
                    <th style="width:120px;">í”Œë«í¼<div class="resizer"></div></th>
                    <th style="width:400px;">URL (ì›ë¬¸)<div class="resizer"></div></th>
                    <th style="width:100px;">ê²€í† ì™„ë£Œ<div class="resizer"></div></th>
                    <th>íŠ¹ì´ì‚¬í•­<div class="resizer"></div></th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTIepAzwHme1ArBFfogzbBZiqqx0Fmz-8qpt3teRp3kLWhp3m8Frdj5-UgYy0fwtqoebtFmfIcZAfs2/pub?gid=0&single=true&output=csv';
    let allData = [];
    let isAsc = true;

    async function init() {
        try {
            const response = await fetch(CSV_URL);
            const text = await response.text();
            allData = parseCSV(text);
            
            createPlatformCheckboxes();
            renderTable(allData);
            initResizers();
        } catch (e) { document.getElementById('status').innerText = "ë¡œë“œ ì‹¤íŒ¨"; }
    }

    function parseCSV(text) {
        const lines = text.split(/\r?\n/);
        const headers = lines[0].split(',').map(h => h.trim());
        return lines.slice(1).filter(l => l.trim()).map(line => {
            const values = line.split(',');
            let obj = {};
            headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : "");
            return obj;
        });
    }

    // 1. ì²´í¬ë°•ìŠ¤ ë™ì  ìƒì„±
    function createPlatformCheckboxes() {
        const container = document.getElementById('platformCheckboxes');
        const platforms = [...new Set(allData.map(d => d['í”Œë«í¼']))].filter(p => p).sort();
        
        container.innerHTML = platforms.map(p => `
            <label class="checkbox-item">
                <input type="checkbox" name="platform" value="${p}" onchange="applyFilters()"> ${p}
            </label>
        `).join('');
    }

    // 2. ê·¸ë£¹ í”„ë¦¬ì…‹ ì„ íƒ ê¸°ëŠ¥
    function selectPreset(platformArray) {
        const checkboxes = document.querySelectorAll('input[name="platform"]');
        checkboxes.forEach(cb => {
            cb.checked = platformArray.includes(cb.value);
        });
        applyFilters();
    }

    function resetCheckboxes() {
        document.querySelectorAll('input[name="platform"]').forEach(cb => cb.checked = false);
        applyFilters();
    }

    // 3. í†µí•© í•„í„° ë¡œì§ (ì²´í¬ë°•ìŠ¤ + ê²€ìƒ‰ì–´)
    function applyFilters() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        
        // ì²´í¬ëœ í”Œë«í¼ë“¤ ê°€ì ¸ì˜¤ê¸°
        const checkedPlatforms = Array.from(document.querySelectorAll('input[name="platform"]:checked'))
                                      .map(cb => cb.value);

        const filtered = allData.filter(row => {
            const matchSearch = Object.values(row).some(v => String(v).toLowerCase().includes(searchTerm));
            // ì„ íƒëœ ê²Œ ì—†ìœ¼ë©´ ì „ì²´ ë³´ì—¬ì£¼ê¸°, ìˆìœ¼ë©´ í¬í•¨ ì—¬ë¶€ í™•ì¸
            const matchPlatform = checkedPlatforms.length === 0 || checkedPlatforms.includes(row['í”Œë«í¼']);
            return matchSearch && matchPlatform;
        });

        renderTable(filtered);
    }

    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = data.map(row => `
            <tr>
                <td>${row['ì „ë‹¬ë‚ ì§œ']}</td>
                <td>${row['í”Œë«í¼']}</td>
                <td class="url-cell"><a href="${row['URL']}" target="_blank">${row['URL']}</a></td>
                <td>${row['ê²€í† ì™„ë£Œ']}</td>
                <td>${row['íŠ¹ì´ì‚¬í•­']}</td>
            </tr>
        `).join('');
        document.getElementById('status').innerText = `ì´ ${data.length}ê±´`;
    }

    // ì •ë ¬ ë° ë¦¬ì‚¬ì´ì € ë¡œì§ (ì´ì „ê³¼ ë™ì¼)
    function toggleSort() {
        isAsc = !isAsc;
        allData.sort((a, b) => isAsc ? new Date(a['ì „ë‹¬ë‚ ì§œ']) - new Date(b['ì „ë‹¬ë‚ ì§œ']) : new Date(b['ì „ë‹¬ë‚ ì§œ']) - new Date(a['ì „ë‹¬ë‚ ì§œ']));
        applyFilters();
    }

    function initResizers() {
        const table = document.getElementById('mainTable');
        table.querySelectorAll('th').forEach(col => {
            const resizer = col.querySelector('.resizer');
            if (!resizer) return;
            resizer.addEventListener('mousedown', (e) => {
                const startX = e.clientX; const startWidth = col.offsetWidth;
                const onMouseMove = (e) => { col.style.width = (startWidth + e.clientX - startX) + 'px'; };
                const onMouseUp = () => { document.removeEventListener('mousemove', onMouseMove); };
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp, {once:true});
            });
        });
    }

    document.getElementById('searchInput').addEventListener('input', applyFilters);
    init();
</script>

</body>
</html>
